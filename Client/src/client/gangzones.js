let gangZones = [
    { "center": { "x": 319.8332, "y": -2185.118, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 413.347351, "y": -2094.81226, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 506.861542, "y": -2004.50671, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 229.5276, "y": -2091.60376, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 323.041779, "y": -2001.29822, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 416.555969, "y": -1910.99255, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 510.070129, "y": -1820.687, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 139.222015, "y": -1998.0896, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 232.736191, "y": -1907.784, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 326.250366, "y": -1817.47839, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 419.764526, "y": -1727.17285, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 513.2787, "y": -1636.86719, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 48.9164276, "y": -1904.57544, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 142.4306, "y": -1814.2699, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 235.944778, "y": -1723.96423, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 329.458923, "y": -1633.65869, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 422.973145, "y": -1543.353, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": -41.38916, "y": -1811.06128, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 52.1250153, "y": -1720.75574, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 145.639191, "y": -1630.45007, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 239.153351, "y": -1540.14453, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 332.667542, "y": -1449.83887, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": -131.694748, "y": -1717.54712, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": -38.1805725, "y": -1627.24158, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 55.3336029, "y": -1536.93591, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 148.847763, "y": -1446.63037, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": -128.48616, "y": -1533.72742, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": -34.9719849, "y": -1443.42175, "z": 90.95729 }, "width": 130.0, "rot": 44.0, "color": 1 },
    { "center": { "x": 734.3699, "y": -2488.151, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 863.8752, "y": -2499.4812, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 993.3805, "y": -2510.81128, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 745.700134, "y": -2358.64551, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 875.205444, "y": -2369.97583, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1004.71075, "y": -2381.306, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1134.21606, "y": -2392.63623, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 757.0304, "y": -2229.14014, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 886.5357, "y": -2240.47046, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1016.041, "y": -2251.80054, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1145.54639, "y": -2263.13086, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 768.360657, "y": -2099.63477, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 897.865967, "y": -2110.965, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1027.37134, "y": -2122.29517, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1156.87659, "y": -2133.62549, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 779.6909, "y": -1970.12939, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 909.1962, "y": -1981.45959, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1038.70154, "y": -1992.78992, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 791.0212, "y": -1840.624, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 920.5265, "y": -1851.95422, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1050.03174, "y": -1863.28455, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 802.35144, "y": -1711.11865, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 931.85675, "y": -1722.44885, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 813.6817, "y": -1581.61328, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 943.187, "y": -1592.94348, "z": 90.95729 }, "width": 130.0, "rot": -5.0, "color": 1 },
    { "center": { "x": 1427.01978, "y": -2490.7312, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1557.0, "y": -2493.0, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1429.28857, "y": -2360.751, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1559.2688, "y": -2363.01978, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1431.55737, "y": -2230.77075, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1561.5376, "y": -2233.03955, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1433.82617, "y": -2100.79053, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1563.8064, "y": -2103.05933, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1306.11475, "y": -1968.5415, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1436.095, "y": -1970.8103, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1566.0752, "y": -1973.0791, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1308.38354, "y": -1838.56128, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1438.36377, "y": -1840.83008, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1568.344, "y": -1843.09888, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1180.67212, "y": -1706.31226, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1310.65234, "y": -1708.581, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1440.63257, "y": -1710.84985, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1570.61279, "y": -1713.11865, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1182.94092, "y": -1576.332, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1312.92114, "y": -1578.60083, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1442.90137, "y": -1580.86963, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 },
    { "center": { "x": 1572.88159, "y": -1583.13843, "z": 90.95729 }, "width": 130.0, "rot": -1.0, "color": 1 }];

let blips = [];
mp.events.add('loadCaptureBlips', function (json) {
    blips.forEach(blip => {
        mp.game.ui.removeBlip(blip);
    })
    blips = [];
    let colors = JSON.parse(json);
    for (let i = 0; i < colors.length; i++) {
        gangZones[i].color = colors[i];
    }
    gangZones.forEach(element => {
        //mp.blips.new()
        const blip = mp.game.ui.addBlipForRadius(element.center.x, element.center.y, element.center.z, element.width / 2);
        mp.game.invoke(global.getNative("SET_BLIP_SPRITE"), blip, 5);
        mp.game.invoke(global.getNative("SET_BLIP_ALPHA"), blip, 175);
        mp.game.invoke(global.getNative("SET_BLIP_COLOUR"), blip, element.color);
        blips.push(blip);
    });
});


mp.events.add('setZoneColor', function (id, color) {
    if (blips.length == 0) return;
    mp.game.invoke(global.getNative("SET_BLIP_COLOUR"), blips[id], color);
});

mp.events.add('setZoneFlash', function (id, state, color) {
    if (blips.length == 1 || blips.length == 0) {
        if (state) {
            if(blips[id]) {
                blips[id].destroy();
            }
            const blip = mp.game.ui.addBlipForRadius(gangZones[id].center.x, gangZones[id].center.y, gangZones[id].center.z, gangZones[id].width / 2);
            mp.game.invoke(global.getNative("SET_BLIP_SPRITE"), blip, 5);
            mp.game.invoke(global.getNative("SET_BLIP_ALPHA"), blip, 175);
            mp.game.invoke(global.getNative("SET_BLIP_COLOUR"), blip, color);
            blips[id] = blip;
        }
        else {
            if (blips.length == 0) return;
            mp.game.invoke(global.getNative("SET_BLIP_ALPHA"), blips[id], 0);
        }
    }

    mp.game.invoke(global.getNative("SET_BLIP_FLASH_TIMER"), blips[id], 1000);
    mp.game.invoke(global.getNative("SET_BLIP_FLASHES"), blips[id], state);
});

mp.events.add('render', () => {
    let i = 0;
    if (blips.length !== 0) {
        blips.forEach(blip => {
            if(gangZones[i]) mp.game.invoke(global.getNative("SET_BLIP_ROTATION"), blip, gangZones[i++].rot);
        })
    }
});


mp.events.add("onConnectionLost", ()=>{
    try {
        blips.forEach(blip => {
            mp.game.ui.removeBlip(blip);
        })
    } catch (e) {
        mp.game.graphics.notify(` ${e.name }\n${e.message}\n${e.stack}`);
    }
});

// mp.events.add('loadCustomBlips', (loadBlips) => {
//     if (loadBlips != null && loadBlips != undefined) {
//         let point = JSON.parse(loadBlips);   
//         let i=0;     
//          point.forEach(element => {
//             //mp.blips.new() mp.game.ui.addBlipForRadius
//             let blip = mp.game.ui.addBlipForRadius(element.center.x, element.center.y, element.center.z, element.width/2);
//             mp.game.invoke(global.getNative("SET_BLIP_SPRITE"), blip, 5);
//             mp.game.invoke(global.getNative("SET_BLIP_ALPHA"), blip, 175);
//             mp.game.invoke(global.getNative("SET_BLIP_COLOUR"), blip, element.c);
//             blipsRot[i]=element.rot;
//             blips.push(blip);
//             i++;
//         });
//     }
// });
